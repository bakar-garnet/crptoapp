name: Garnet CI Monitoring

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  monitor:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # ‚úÖ EXACT Garnet snippet you posted
      - name: Add Garnet Monitor
        uses: garnet-org/action@v1
        with:
          api_token: ${{ secrets.GARNET_API_TOKEN }}

      # üî• Workload (generates file/network/exec/env behaviors)
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install root deps
        run: npm install

      - name: Install Python deps
        run: pip install -r python/requirements.txt

      - name: Run ‚Äúbehavior soup‚Äù
        env:
          INFURA_URL: "https://mainnet.infura.io/v3/INVALID_KEY_OK"
          ALCHEMY_URL: "https://eth-mainnet.g.alchemy.com/v2/INVALID_KEY_OK"
          SOME_SECRET: "not-a-real-secret"
        run: |
          node tools/behavior-soup.mjs
          (cd contracts && npm install && npx hardhat compile)
          python python/chain_probe.py
